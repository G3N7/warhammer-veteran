# Tacticus Validation Rules - Machine-Readable Format
# CRITICAL: Load this BEFORE building any list. Check EVERY rule.
# Last Updated: 2026-02-09
# Version: 1.2

# ============================================================
# FACTION ABILITIES - Chapter-specific rules (10th Edition)
# CRITICAL: Divergent chapters have DIFFERENT rules than vanilla
# ============================================================
faction_abilities:

  oath_of_moment:
    description: "Space Marines faction ability - select one enemy unit per Command phase"
    vanilla_chapters:
      benefit: "Re-roll hit rolls AND +1 to wound rolls vs Oath target"
      applies_to: "Codex-compliant chapters without divergent keywords"
    divergent_chapters:
      benefit: "Re-roll hit rolls ONLY - do NOT get +1 to wound"
      applies_to: ["Space Wolves", "Blood Angels", "Dark Angels", "Black Templars", "Deathwatch"]
      note: "These chapters are explicitly excluded from the +1 to wound bonus"
    source: "Codex Space Marines 10th Edition"
    verified: "2025-01-03"

  # Space Wolves additional abilities
  curse_of_the_wulfen:
    faction: "Space Wolves"
    description: "+1 OC to INFANTRY within 12\" of CHARACTER/Wolf Priest, +3 OC to VEHICLES"
    exclusions: ["Wulfen", "Battle-shocked units"]
    source: "Space Wolves Codex Supplement"
    verified: "2025-01-03"

# ============================================================
# HARD RULES - Violations make list ILLEGAL
# ============================================================
hard_rules:

  leader_count:
    rule: "Maximum 1 Leader per unit unless datasheet explicitly says 'can attach alongside another Leader'"
    check: "Before claiming two characters can join same unit, verify BOTH have 'alongside' text in their Leader ability"
    common_error: "Assuming Logan + Arjac can join same Wolf Guard Terminator unit - they cannot"
    date: "2026-01-26"

  rule_of_three:
    applies_to: "matched play"
    rule: "Max 3 units per datasheet (except BATTLELINE and DEDICATED TRANSPORT)"
    check: "Count units by datasheet name. If any non-exempt > 3, ILLEGAL."
    exempt_keywords: ["BATTLELINE", "DEDICATED TRANSPORT"]

  points_limit:
    rule: "Total points must be <= game size limit"
    limits: {500: 500, 1000: 1000, 2000: 2000}
    check: "Sum all unit points + enhancement points. If > limit, ILLEGAL."

  epic_hero_unique:
    rule: "Each Epic Hero can only appear once per army"
    check: "If same Epic Hero appears twice, ILLEGAL."

  enhancement_eligibility:
    rule: "Enhancements can ONLY be given to CHARACTER models without EPIC HERO keyword"
    check: "Before assigning enhancement, verify target.epic_hero == false AND 'CHARACTER' in target.keywords"
    common_error: "Assigning enhancements to named characters (Logan Grimnar, Shadowsun, etc.)"

  enhancement_limit:
    rule: "Max 1 enhancement per CHARACTER. Max enhancements = game size dependent."
    limits: {500: 1, 1000: 1, 2000: 3}
    check: "Count enhancements assigned. Count characters with enhancements."

  unit_sizes:
    rule: "Units must be legal sizes per datasheet"
    check: "unit.models must be in unit.sizes range"

# ============================================================
# COLOSSEUM FORMAT - King of the Colosseum (500pt)
# Source: Play On Tabletop (playontabletop.com)
# ============================================================
colosseum_format:
  points_limit: 500
  restrictions:
    characters:
      rule: "Must have at least 1 CHARACTER"
      check: "Count CHARACTER keyword units >= 1"
    epic_heroes:
      rule: "No Epic Heroes allowed"
      check: "No unit may have EPIC HERO keyword"
    max_toughness:
      rule: "Maximum Toughness of any unit is T9"
      check: "Every unit.T <= 9"
    infantry_minimum:
      rule: "Must have 2+ INFANTRY units (excluding characters)"
      check: "Count non-CHARACTER units with INFANTRY keyword >= 2"
  mission_format:
    rounds: "Best of 3 games"
    time: "1 hour 10 minutes per round"
    missions: ["Terraform", "Take and Hold", "Linchpin"]
    secondaries: "Tactical only"
  scoring:
    objective_points: "5 VP per objective held (max 15 per round, 50 per game)"
    starts_scoring: "Turn 2"
  source: "https://playontabletop.com/king-of-the-colosseum/"
  verified: "2026-01-18"

# ============================================================
# VALIDATION GATES - Run in order before presenting any list
# ============================================================
validation_gates:

  gate_1_data_loaded:
    - "Faction datasheet loaded (compact.json)"
    - "Detachment rules known"
    - "Edition confirmed (10th Edition)"

  gate_2_unit_legality:
    - "Every unit exists in faction datasheet"
    - "Unit sizes are legal per datasheet"
    - "Wargear options are legal (if specified)"

  gate_3_composition:
    - "Rule of Three: count by datasheet, verify <= 3"
    - "Epic Heroes: verify unique, no duplicates"
    - "Enhancements: verify CHARACTER + not EPIC HERO"

  gate_4_points:
    - "Calculate: sum(unit.pts * unit.count) + sum(enhancement.pts)"
    - "Verify: total <= game_size"
    - "Show math: list each unit with calculation"

  gate_5_self_review:
    - "Check 3 potential issues with own work"
    - "Cross-reference prose vs table (model counts match)"

  gate_6_wargear_stat_effects:
    - "For each unit, check if any wargear modifies stats (W, T, Sv, Invuln)"
    - "Storm shields: +1W per model equipped (4W total instead of 3W)"
    - "Other stat-modifying wargear: verify calculations reflect ACTUAL equipped options"
    - "Cross-reference assembly guide loadouts against wound/stat calculations"
    - "If assembly shows X models with shield, wound calc MUST show X × 4W separately"

  gate_7_leader_attachments:
    blocking: true
    description: "Verify all character-to-unit attachments are legal per datasheet"
    steps:
      - "For EACH character assigned to lead a unit:"
      - "  1. Load character datasheet from compact cache"
      - "  2. Read character.leads array"
      - "  3. Verify attached unit name EXACTLY matches an entry in leads array"
      - "  4. If NO MATCH → ILLEGAL ATTACHMENT → STOP and fix"
    common_errors:
      - "Logan Grimnar (foot) leads Wolf Guard Terminators. Logan on Stormrider leads ONLY Thunderwolf Cavalry."
      - "Ragnar Blackmane leads Wolf Guard Headtakers OR Blood Claws ONLY - NOT Hounds of Morkai"
      - "Arjac Rockfist leads Wolf Guard Terminators ONLY"
    verification: "After assigning, state: '[Character] leads [Unit] - verified against cache: leads = [array]'"

  gate_8_prose_table_sync:
    blocking: true
    description: "Every unit mentioned in prose MUST exist in army table"
    steps:
      - "After writing list, scan Tactics/Strengths/Weaknesses sections"
      - "Extract every unit name mentioned"
      - "Verify each unit EXISTS in army composition table"
      - "If unit mentioned but NOT in table → REMOVE from prose OR add to table"
    example_error: "Tactics says 'Headtakers hold objective' but no Headtakers unit in list"

  gate_9_points_from_cache:
    blocking: true
    description: "All points values MUST come from loaded cache, not memory"
    steps:
      - "BEFORE writing any points value, load compact cache for faction"
      - "For EACH unit, lookup pts or pts_per_model from cache"
      - "Show calculation: 'Cache says X pts/model × Y models = Z pts'"
      - "If cache returns null/missing → run --add-unit before proceeding"
      - "NEVER write points from memory - always cite cache"
    verification: "State data source for each unit: '[Unit]: cache says [X]pts'"

  gate_10_wargear_verification:
    blocking: true
    description: "Before recommending ANY wargear, verify it exists on current 10th edition datasheet"
    steps:
      - "Load {faction}.json (full datasheet) or run --unit command"
      - "Extract unit.weapons.ranged and unit.weapons.melee arrays"
      - "Only recommend weapons that exist in current data"
      - "If uncertain, run: python3 scrape-wahapedia.py --unit {faction} 'Unit Name'"
    prevention: "Never recommend wargear from memory - 10th Edition changed many options (Thunder Hammers removed from WG Terminators, etc.)"
    date: "2026-01-26"

  gate_11_ability_exact_text:
    blocking: true
    description: "Before explaining ANY ability, quote exact text from datasheet first"
    steps:
      - "Load unit datasheet (cache or --unit command)"
      - "Find ability by name in abilities.unit array"
      - "Quote exact text in response: 'Ability says: [exact text]'"
      - "THEN explain what it means in plain language"
    prevention: "Paraphrasing leads to wrong interpretations (e.g., 'any unit' vs 'this unit', 'once per battle' vs 'once per turn')"
    example_error: "Logan's ability says 'one unit from your army' but was paraphrased as 'his unit'"
    date: "2026-01-26"

  gate_12_leader_count:
    blocking: true
    description: "Verify each unit has at most ONE attached Leader"
    steps:
      - "For each unit in army list, count attached Leaders"
      - "If count > 1, check BOTH leaders for 'can attach alongside' text"
      - "If neither has 'alongside' text → ILLEGAL → remove one leader"
    common_errors:
      - "Logan + Arjac in same Terminator unit (neither can attach alongside)"
      - "Wolf Priest + Njal in same Blood Claws (neither can attach alongside)"
    date: "2026-01-26"

# ============================================================
# KNOWN CORRECTIONS - Overrides for datasheet errors
# When these units appear, use THESE values not cached data
# ============================================================
corrections:

  # Format: unit_name: {field: corrected_value, source: "where verified", date: "YYYY-MM-DD"}

  # Space Wolves corrections verified 2025-12-27
  arjac_rockfist:
    pts: 105
    epic_hero: true
    source: "New Recruit app"
    date: "2025-12-27"

  bjorn_the_fell_handed:
    pts: 160
    epic_hero: true
    source: "Wahapedia"
    date: "2025-12-27"

  logan_grimnar:
    pts: 110
    epic_hero: true
    source: "Wahapedia scrape"
    date: "2025-12-28"

  ragnar_blackmane:
    pts: 100
    epic_hero: true
    source: "Wahapedia scrape"
    date: "2025-12-28"

  murderfang:
    pts: 150
    epic_hero: true
    source: "Wahapedia scrape"
    date: "2025-12-28"

  # T'au corrections verified 2025-12-28
  commander_shadowsun:
    pts: 100
    epic_hero: true
    source: "Wahapedia scrape"
    date: "2025-12-28"

  commander_farsight:
    pts: 85
    epic_hero: true
    source: "Wahapedia scrape"
    date: "2025-12-28"

  longstrike:
    pts: 140
    epic_hero: true
    source: "Wahapedia scrape"
    date: "2025-12-28"

  # Astra Militarum corrections
  lord_solar_leontus:
    pts: 130
    epic_hero: true
    M: "12\""
    T: 4
    Sv: "3+"
    W: 8
    Ld: "6+"
    OC: 2
    invuln: "4+"
    source: "Wahapedia verified"
    date: "2025-12-29"

  leman_russ_punisher:
    pts: 150
    M: "10\""
    T: 11
    Sv: "2+"
    W: 13
    Ld: "7+"
    OC: 3
    note: "List file incorrectly showed 190pts"
    source: "Wahapedia verified"
    date: "2025-12-29"

  leman_russ_demolisher:
    pts: 190
    M: "10\""
    T: 11
    Sv: "2+"
    W: 13
    Ld: "7+"
    OC: 3
    source: "Wahapedia verified"
    date: "2025-12-29"

  ratlings:
    pts_5: 60
    pts_10: 100
    M: "6\""
    T: 2
    Sv: "6+"
    W: 1
    Ld: "8+"
    OC: 1
    abilities: ["Infiltrators", "Stealth", "Shoot Sharp and Scarper"]
    source: "Wahapedia verified"
    date: "2025-12-29"

  gaunts_ghosts:
    pts: 100
    epic_hero: true  # Ibram Gaunt is EPIC HERO
    models: 6
    source: "Wahapedia verified"
    date: "2025-12-29"

  # Orks corrections verified 2025-12-29
  big_mek:
    pts: 70
    M: "6\""
    T: 5
    Sv: "3+"
    W: 6
    Ld: "7+"
    OC: 1
    can_lead: ["Boyz", "Breaka Boyz", "Lootas", "Mek Gunz", "Nobz", "Tankbustas"]
    source: "Wahapedia verified"
    date: "2025-12-29"

  lootas:
    pts_5: 50
    pts_10: 100
    M: "6\""
    T: 5
    Sv: "5+"
    W: 1
    Ld: "7+"
    OC: 1
    source: "Wahapedia verified"
    date: "2025-12-29"

  # Tyranids - SYNAPSE clarification
  # These units do NOT have SYNAPSE keyword (common mistake)
  exocrine:
    has_synapse: false
    note: "Must stay in Synapse aura, does NOT provide it"
    source: "User correction"
    date: "2025-12-26"

  tyrannofex:
    has_synapse: false
    note: "Must stay in Synapse aura, does NOT provide it"
    source: "User correction"
    date: "2025-12-26"

  carnifexes:
    has_synapse: false
    note: "Must stay in Synapse aura, does NOT provide it"
    source: "User correction"
    date: "2025-12-26"

  # These DO have SYNAPSE
  hive_tyrant:
    has_synapse: true
    source: "Wahapedia"
    date: "2025-12-26"

  winged_hive_tyrant:
    has_synapse: true
    source: "Wahapedia"
    date: "2025-12-26"

  neurothrope:
    has_synapse: true
    source: "Wahapedia"
    date: "2025-12-26"

# ============================================================
# MISTAKE PATTERNS - Common errors to actively check for
# Format: pattern_name, description, prevention_check
# ============================================================
mistake_patterns:

  epic_hero_enhancement:
    description: "Assigning enhancements to Epic Heroes"
    frequency: "HIGH - happened 4+ times"
    prevention: "BEFORE assigning ANY enhancement: check unit.epic_hero == false"
    affected_units: ["Logan Grimnar", "Arjac Rockfist", "Commander Shadowsun", "Lord Solar Leontus", "Longstrike"]

  points_overage:
    description: "List exceeds points limit"
    frequency: "MEDIUM - happened 3 times"
    prevention: "Re-add all units BEFORE presenting. Never assume math is correct."

  outdated_wargear:
    description: "Using wargear from previous editions"
    frequency: "MEDIUM - Wolf Guard Terminators thunder hammers"
    prevention: "Verify wargear against current datasheet. 10th Ed changed many options."

  keyword_hallucination:
    description: "Claiming units have keywords they don't have (SYNAPSE, DEEP STRIKE)"
    frequency: "LOW - Tyranid SYNAPSE error"
    prevention: "Only claim keywords that appear in datasheet.keywords or datasheet.core"

  prose_table_mismatch:
    description: "Model counts in prose sections don't match army table"
    frequency: "MEDIUM - happened with Headtakers in Stormlance list"
    prevention: "After writing tactics/strengths, cross-reference model counts against table"
    example: "Tactics said 'Headtakers hold objective' but no Headtakers unit existed in list"
    date: "2026-01-19"

  leader_attachment_error:
    description: "Assigning a character to lead a unit they cannot legally lead per datasheet"
    frequency: "HIGH - happened with Logan Stormrider + Ragnar in same list"
    prevention: |
      BEFORE assigning ANY character as leader:
      1. Load character datasheet from compact cache
      2. Read the character.leads array EXACTLY
      3. Verify target unit name is IN that array
      4. Watch for VARIANT DATASHEETS (Logan foot vs Logan Stormrider are DIFFERENT)
    occurrences:
      - error: "Logan Grimnar on Stormrider (180pts) assigned to lead Wolf Guard Terminators"
        reality: "Stormrider version can ONLY lead Thunderwolf Cavalry. Foot version (110pts) leads Terminators."
        date: "2026-01-19"
      - error: "Ragnar Blackmane assigned to lead Hounds of Morkai"
        reality: "Ragnar can ONLY lead Wolf Guard Headtakers or Blood Claws"
        date: "2026-01-19"
    affected_characters:
      logan_grimnar_foot:
        pts: 110
        leads: ["Wolf Guard Terminators"]
      logan_grimnar_stormrider:
        pts: 180
        leads: ["Thunderwolf Cavalry"]
      ragnar_blackmane:
        pts: 100
        leads: ["Wolf Guard Headtakers", "Blood Claws"]
      arjac_rockfist:
        pts: 105
        leads: ["Wolf Guard Terminators"]

  points_from_memory_error:
    description: "Writing points values from memory instead of loading from cache"
    frequency: "HIGH - 4 units had wrong points in single list"
    prevention: |
      NEVER write a points value without first loading compact cache.
      For EACH unit: state "Cache says: [unit] = [X]pts" before writing.
    occurrences:
      - unit: "Hounds of Morkai ×5"
        wrong: 85
        correct: 80
        calculation: "5 × 16pts = 80pts"
        date: "2026-01-19"
      - unit: "Ballistus Dreadnought"
        wrong: 140
        correct: 150
        date: "2026-01-19"
      - unit: "Eradicator Squad ×3"
        wrong: 95
        correct: 90
        calculation: "3 × 30pts = 90pts"
        date: "2026-01-19"
      - unit: "Assault Intercessors ×5"
        wrong: 80
        correct: 75
        calculation: "5 × 15pts = 75pts"
        date: "2026-01-19"

  storm_shield_wounds:
    description: "Forgetting that storm shields give +1W (total 4W instead of 3W)"
    frequency: "HIGH - Space Wolves Wolf Guard Terminators"
    prevention: "When calculating total wounds, check assembly guide for shield count. Shield bearers = 4W each, non-shield = 3W each."
    affected_units: ["Wolf Guard Terminators", "Relic Terminators", "Assault Terminators"]
    date: "2025-01-03"

  enhancement_name_error:
    description: "Using enhancement names not in the detachment's actual rules"
    occurrences:
      - detachment: "Grizzled Company"
        wrong: ["Drill Commander", "Grand Strategist", "Death Mask of Ollanius", "Gatekeeper"]
        correct: ["Aquilan Eye", "Spec Ops Veteran", "Laud Hailer"]
        date: "2025-12-30"
      - detachment: "Saga of the Beastslayer"
        wrong: ["Blade of the Slayer"]
        correct: "See validation-rules.yaml"
        date: "2025-12-27"
    prevention: "Verify against validation-rules.yaml or Wahapedia before using any enhancement name"

  faction_ability_hallucination:
    description: "Claiming faction abilities from previous editions or assuming all chapters are identical"
    frequency: "HIGH - happened with Space Wolves Oath of Moment"
    occurrences:
      - error: "Claimed Space Wolves have 'Saga of the Beast' faction ability"
        reality: "'Saga of the Beast' is a 9th Edition supplement BOOK NAME, not a 10th Ed rule"
        date: "2025-01-03"
      - error: "Claimed Space Wolves get full Oath of Moment (re-roll hits + wound)"
        reality: "Divergent chapters (SW/BA/DA/BT/DW) only get re-roll hits, NOT +1 to wound"
        date: "2025-01-03"
    prevention: |
      1. NEVER assume faction abilities without checking validation-rules.yaml → faction_abilities section
      2. Divergent chapters have DIFFERENT rules than vanilla Marines
      3. If uncertain, web search "[faction] 10th edition faction ability" before claiming
      4. Edition names (Saga of the Beast, Codex Supplement titles) are NOT rules
    affected_factions: ["Space Wolves", "Blood Angels", "Dark Angels", "Black Templars", "Deathwatch"]

  leader_count_error:
    description: "Assuming multiple leaders can attach to same unit without verification"
    frequency: "MEDIUM"
    prevention: "Only ONE leader per unit. Check for explicit 'can attach alongside another Leader' text before claiming otherwise."
    occurrences:
      - error: "Logan + Arjac in same Wolf Guard Terminators unit"
        reality: "One leader per unit is the core rule. Neither has 'alongside' text. They must lead separate units."
        date: "2026-01-26"
    affected_characters: ["Logan Grimnar", "Arjac Rockfist", "Wolf Priest", "Njal Stormcaller"]

  ability_paraphrase_error:
    description: "Misinterpreting ability by not reading exact text from datasheet"
    frequency: "HIGH"
    prevention: "ALWAYS load datasheet and quote exact ability text before interpreting what it does"
    occurrences:
      - unit: "Logan Grimnar"
        ability: "The Great Wolf"
        error: "Claimed ability only affects 'the unit he's attached to'"
        reality: "Text says 'one unit from your army can be set up on the battlefield' - ANY reserve unit, not just his"
        date: "2026-01-26"
    affected_abilities: ["Logan's reserve ability", "Any 'once per battle' vs 'once per turn' ability"]

  wargear_memory_error:
    description: "Recommending wargear options from memory instead of verifying against current datasheet"
    frequency: "HIGH - 10th edition removed many options"
    prevention: "Load datasheet.weapons array before recommending ANY wargear. Run --unit command if uncertain."
    occurrences:
      - unit: "Wolf Guard Terminators"
        error: "Recommended Thunder Hammers as wargear option"
        reality: "Thunder Hammers NOT on 10th Edition WG Terminator datasheet. Actual options: MC Power Weapon, Power Fist, Twin Lightning Claws, Chainfist"
        date: "2026-01-26"
    affected_units: ["Wolf Guard Terminators", "Any unit that had options removed in 10th Edition"]
    removed_options_examples:
      - unit: "Wolf Guard Terminators"
        removed: ["Thunder Hammer", "Frost Weapon", "Wolf Claw"]
        current: ["MC Power Weapon", "Power Fist", "Twin Lightning Claws", "Chainfist", "Storm Shield"]

# ============================================================
# DETACHMENT ENHANCEMENTS - Quick reference
# ============================================================
detachments:

  # === SPACE WOLVES ===
  saga_of_the_beastslayer:
    faction: "Space Wolves"
    ability: "Lethal Hits vs CHARACTER, MONSTER, VEHICLE. Once you kill half (rounded up) of enemy CHARACTER/MONSTER/VEHICLE units, Lethal Hits applies to everything."
    enhancements:
      - {name: "Elder's Guidance", pts: 20, effect: "Once per battle, bearer (+Blood Claws unit if leading) gains +1 AP"}
      - {name: "Helm of the Beastslayer", pts: 15, effect: "Reduces AP of incoming attacks by 1"}
      - {name: "Hunter's Guile", pts: 20, effect: "Redeploy up to 3 Thunderwolf Cavalry/Wulfen/Blood Claws units pre-game"}
      - {name: "Wolf-Touched", pts: 15, effect: "+2\" Move, bearer can join Wulfen units"}

  stormlance_task_force:
    faction: "Space Wolves"
    ability: "Lightning Assault: ADEPTUS ASTARTES units can charge after Advancing. Units can also charge after Falling Back."
    enhancements:
      - {name: "Fury of the Storm", pts: 25, restriction: "MOUNTED CHARACTER", effect: "Bearer's melee weapons +1S/+1AP, or +2S/+2AP if bearer charged this turn"}
      - {name: "Hunter's Instincts", pts: 10, restriction: "MOUNTED CHARACTER in RESERVES", effect: "Bearer's unit counts battle round as 1 higher for Reserves arrival"}
      - {name: "Portents of Wisdom", pts: 15, effect: "While leading, re-roll Advance rolls for led unit"}
      - {name: "Feinting Withdrawal", pts: 20, effect: "While leading, unit can Fall Back and Shoot"}
    note: "Previous entry had wrong enhancement names (Beastslayer's Oath, Black Death, Frost Weapon, Wolf Tail Talisman). Corrected 2026-02-14 via Wahapedia/Goonhammer/AdeptusArs verification."
    stratagem_notes:
      ride_hard_ride_fast:
        target: "MOUNTED or FLY VEHICLE (excludes WALKERS)"
        phase: "Enemy Shooting"
        effect: "-1 to Hit and -1 to Wound vs target unit"
        warning: "Venerable Dreadnoughts and other WALKERS are NOT valid targets. Only MOUNTED (Thunderwolf Cavalry) or FLY VEHICLE units qualify."
        date: "2026-02-12"

  # === SPACE MARINES (Ultramarines) ===
  gladius_task_force:
    faction: "Space Marines"
    ability: "Combat Doctrines: Devastating Wounds (turn 1), Sustained Hits 1 (turn 2), Lethal Hits (turn 3+)"
    enhancements:
      - {name: "Adept of the Codex", pts: 20, effect: "Once per battle, change Combat Doctrine for your army"}
      - {name: "Artificer Armour", pts: 10, effect: "2+ Save, 5+ Feel No Pain vs mortal wounds"}
      - {name: "Fire Discipline", pts: 30, effect: "Ranged attacks score critical hits on 5+"}
      - {name: "The Honour Vehement", pts: 15, effect: "Melee attacks get Lethal Hits + Devastating Wounds turn 3+"}

  # === T'AU EMPIRE ===
  kauyon:
    faction: "T'au Empire"
    ability: "Full re-rolls to hit if unit remained stationary"
    enhancements:
      - {name: "Puretide Engram Neurochip", pts: 25, effect: "Once per battle, re-roll all hits and wounds"}
      - {name: "Precision of the Patient Hunter", pts: 20, effect: "Ranged weapons gain [IGNORES COVER]"}
      - {name: "Through Unity, Devastation", pts: 40, effect: "Aura: Core units re-roll 1s to wound"}
      - {name: "The Be'gel Hunter's Plate", pts: 15, effect: "4+ invulnerable save"}

  mont_ka:
    faction: "T'au Empire"
    ability: "Re-roll Advance/Charge. +1 to hit if target is closest eligible."
    enhancements:
      - {name: "Exemplar of the Mont'ka", pts: 25, effect: "Unit falls back and still shoots/charges"}
      - {name: "Precision of the Killing Blow", pts: 20, effect: "[PRECISION] on all ranged weapons"}
      - {name: "Starflare Ignition System", pts: 20, effect: "Once per battle, 12\" move after shooting"}
      - {name: "The Thermoneutronic Projector", pts: 30, effect: "Flamer weapons get +1 Strength and Damage"}

  # === ASTRA MILITARUM ===
  # VERIFIED from New Recruit app 2025-12-30
  grizzled_company:
    faction: "Astra Militarum"
    ability: "Ruthless Discipline: +1 Order per Officer. Ordered units re-roll 1s to hit; also re-roll 1s to wound if target is on objective."
    enhancements:
      - {name: "Aquilan Eye", pts: 20, effect: "New Order: Target Weak Spot - ranged attacks vs enemies within 12\" get +1 AP"}
      - {name: "Spec Ops Veteran", pts: 15, effect: "New Order: Move to the Shadows - unit gains Stealth vs ranged attacks", restriction: "INFANTRY OFFICER only"}
      - {name: "Laud Hailer", pts: 10, effect: "Order range increased to 12\" instead of 6\""}

  combined_regiment:
    faction: "Astra Militarum"
    ability: "Infantry units count as being in range of an Officer for Orders"
    enhancements:
      - {name: "Cadia Stands!", pts: 15, effect: "Once per battle, unit fights on death"}
      - {name: "Death World Veteran", pts: 20, effect: "+1 Attacks, +1 Toughness"}
      - {name: "Regimental Standard", pts: 15, effect: "12\" aura: re-roll Battle-shock tests"}
      - {name: "Vox-caster", pts: 5, effect: "Orders affect units 24\" away"}

  # === ORKS ===
  dread_mob:
    faction: "Orks"
    ability: "WALKERS get 5+ Feel No Pain. Big Meks repair D3+1 wounds."
    enhancements:
      - {name: "Choppa Hauler", pts: 25, effect: "VEHICLE gains [DEADLY DEMISE D3]"}
      - {name: "Kustom Shokka", pts: 15, effect: "Shokk Attack Gun gains [DEVASTATING WOUNDS]"}
      - {name: "Orky Know-Wots", pts: 20, effect: "Big Mek: healed model fights immediately"}
      - {name: "Smoky Gubbinz", pts: 15, effect: "Benefit of Cover always, -1 to be hit"}

  waaagh_tribe:
    faction: "Orks"
    ability: "Call a Waaagh!: +1 Strength, +1 Attack, charge after Advance"
    enhancements:
      - {name: "'Eadwoppa's Killchoppa", pts: 25, effect: "One melee weapon: [DEVASTATING WOUNDS]"}
      - {name: "Brutal but Kunnin'", pts: 15, effect: "Once per battle: melee attacks auto-wound"}
      - {name: "Follow Me Ladz!", pts: 25, effect: "+3\" to charges for led unit"}
      - {name: "Supa-Cybork Body", pts: 15, effect: "4+ Feel No Pain"}

  # === TYRANIDS ===
  crusher_stampede:
    faction: "Tyranids"
    ability: "MONSTER units reduce AP by 1. Get +1 OC when below Starting Strength."
    enhancements:
      - {name: "Adaptive Biology", pts: 25, effect: "4+ Feel No Pain after first wound taken"}
      - {name: "Enraged Reserves", pts: 15, effect: "+1 Attack and Strength when below half wounds"}
      - {name: "Synaptic Linchpin", pts: 20, effect: "Synapse range extended to 9\""}
      - {name: "Rampaging Beast", pts: 15, effect: "Re-roll charge rolls, +1 Attack on charge"}

  invasion_fleet:
    faction: "Tyranids"
    ability: "Synapse Imperative: choose buff each Command phase for Synapse units"
    enhancements:
      - {name: "Alien Cunning", pts: 30, effect: "Redeploy up to 3 units pre-game"}
      - {name: "Perfectly Adapted", pts: 15, effect: "Re-roll one hit, wound, damage, or save per turn"}
      - {name: "Synaptic Control", pts: 20, effect: "12\" aura: re-roll Battle-shock"}
      - {name: "The Dirgeheart of Kharis", pts: 20, effect: "Once per battle, enemy unit -1 to hit you"}

# ============================================================
# KNOWN ERRATA - FAQ/errata changes affecting user's armies
# Cross-reference: arbitrator-sidecar/faq-registry.yaml for full details
# ============================================================
known_errata:

  orks_thievin_scavengers:
    faction: "Orks"
    rule: "Thievin' Scavengers (Deathskulls)"
    change: "Max 1 CP per battle round regardless of objectives held"
    source: "Orks FAQ v1.2"
    impact: "Lists must NOT claim multi-CP generation per turn"

  wolf_guard_terminator_wargear:
    faction: "Space Wolves"
    rule: "Wolf Guard Terminator options"
    change: "10th Ed limits to: MC Power Weapon, Power Fist, Twin Lightning Claws, Chainfist, Storm Shield"
    removed: ["Thunder Hammer", "Frost Weapon", "Wolf Claw"]
    impact: "BLOCKING - never recommend removed wargear options"

  devastating_wounds_fnp:
    faction: "All"
    rule: "Devastating Wounds mortal wound interaction"
    change: "Mortal wounds from Devastating Wounds CAN be saved by Feel No Pain"
    source: "Core Rules FAQ v1.3"
    impact: "Affects damage calculations for DW-heavy armies"

  leader_detachment:
    faction: "All"
    rule: "Leader voluntary unit departure"
    change: "Leaders CANNOT voluntarily leave units once attached in 10th Edition"
    source: "Core Rules"
    impact: "No mid-game leader swapping between units"

# ============================================================
# META SNAPSHOT - February 2026
# Refresh: Monthly or after balance dataslate
# ============================================================
meta:
  last_updated: "2026-02-09"
  dataslate: "January 2026"
  munitorum_field_manual: "January 2026"

  s_tier:
    - "Astra Militarum"
    - "Space Marines (various chapters)"
    - "Drukhari"
    - "Chaos Daemons"
    - "Death Guard"

  a_tier:
    - "Adepta Sororitas"
    - "Imperial Knights"
    - "T'au Empire (Kauyon)"

  notes:
    - "Aeldari nerfed hard (Skyborne Sanctuary changes)"
    - "T'au + GSC left untouched despite needing help"
    - "Tank-heavy armies stable"
    - "MFM January 2026 points in effect - verify all lists against current MFM"
    - "Stormlance Task Force emerging as competitive Space Wolves detachment"
